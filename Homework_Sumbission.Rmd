---
title: "Assignment Template"
output:
  pdf_document: default
  html_document: default
date: "2024-11-08"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE) #this makes the document default to have echo = TRUE
```

*The following is a template .rmd RMarkdown file for you to use for your homework submission.*

*Please Knit your .rmd to a PDF format or HTML and submit that with no identifiers like your name.*

*To create a PDF, first install tinytex and load the package. Then press the Knit arrow and select "Knit to PDF".*

## QUESTION 01: Data Visualisation for Science Communication

*Create a figure using the Palmer Penguin dataset that is correct but badly communicates the data. **Do not make a boxplot**.*

*Use the following references to guide you:*

-   [*https://www.nature.com/articles/533452a*](https://www.nature.com/articles/533452a){.uri}
-   [*https://elifesciences.org/articles/16800*](https://elifesciences.org/articles/16800){.uri}

*Note: Focus on visual elements rather than writing misleading text on it.*

### a) Provide your figure here:

```{r bad figure code, echo=FALSE}

# Make sure your figure is visible after you knit it. 

ggplot(data = penguins_clean, aes(x = date_egg, y = body_mass_g)) +
  stat_smooth(method = "lm", se = FALSE, color = "darkred", 
              geom = "line", 
              size = 1,  # Increase line thickness
              arrow = arrow(length = unit(0.2, "cm"), ends = "last", type = "closed")) +
  geom_point(color = "darkred", alpha = 0.2) +
  coord_fixed(ratio = 2) +
  theme_minimal() +
  theme(axis.text.y = element_blank()) +
  scale_y_continuous() +
  coord_cartesian(ylim = c(4150, 4300)) +

    scale_x_date(
    breaks = as.Date(c("2008-01-01", "2008-07-01", "2009-01-01", "2009-07-01", "2010-01-01")),
    labels = c(expression(bold("2008-01")), "2008-07", "2009-01", "2009-07", "2010-01")
  ) +
  labs(
    title = "Palmer Penguin Body Mass over Time",
    x = "Time since Chef Smith's Arrival",
    y = "Body Mass (g)"
  )

#^fix X-axis cut-off >55 words too long
```

### b) Write about how your design choices mislead the reader about the underlying data (100-300 words).

Imagine a scenario where I am in an argument with Chef Smith in my Antarctic field station. I devise a plan to get them fired by convincing the public that their food waste is causing an obesity epidemic around the Palmer Station, Antarctica LTER. Taking to twitter, I share the above graph.

Points of deception:

-   I have started the graph from where the linear relationship begins, rather than 0 or another appropriate point. This exaggerates the steepness of the linear relationship, which would look almost negligible if seen as it should be.

-   I am only using the species Gentoo, but extrapolating to all Palmer Penguin's in the title. In fact, Adelie Penguins have gotten smaller since Chef Smith's arrival. (N.B. I am taking the graph title and axis labels to be "visual elements").

-   I have elected to make the line red, a colour commonly associated with negatives. This helps as there is no clear backing that the weight "increase" is really a negative.

-   I have made the line an arrow, in the hopes that it will convince of a continued projected increase should Chef Smith remain employed.

-   Rather than labelling with the objective "Date", I have drawn attention to how time relates to my intended point.

-   I have used the code "coord_fixed(ratio = 10)" which stretches the graph vertically and hugely exaggerates the steepness of the line.

-   I have used the code "coord_fixed(ratio = 10)" which stretches the graph vertically and hugely exaggerates the steepness of the line.

-   I have made the individual label 2008-01 bold. I did this while ensuring the axes remain the same as when they are entered in a repeatable manner, so it remains technically "correct". The intended effect is to again call attention to the false association between Chef Smith's arrival and increased penguin body mass.

-   I used scale_y_continuous() along with coord_cartesian(ylim = c(x1, x2)). This enabled me to manipulate the y axis, while coord_cartesian() ensured that the "zoom effect" excludes the data points from the graph but not the lm(). This circumvents an issue where it looks too obviously fabricated without any data visible.

------------------------------------------------------------------------

## QUESTION 2: Data Analysis Pipeline

*Write a data analysis pipeline.*

*You should be aiming to write a clear explanation of the steps as well as clear code.*

*Your code should include the steps practiced in the lab session:*

Written in the structure of a paper.

-   Load the data
-   *Appropriately clean the data*
-   *Create an Exploratory Figure (**not a boxplot**)*
-   *Save the figure*
-   ***New**: Run a statistical test*
-   ***New**: Create a Results Figure*
-   *Save the figure*

*An exploratory figure shows raw data, such as the distribution of the data. A results figure demonstrates the stats method chosen, and includes the results of the stats test or model.*

*Between your code, communicate clearly what you are doing and why.*

*Your text should include:*

-   *Introduction*

-   *Hypothesis*

-   *Stats Method*

-   *Results*

-   *Discussion*

-   *Conclusion*

*You will be marked on the following:*

1.  Your code for readability and functionality

2.  Your figures for communication

3.  Your text communication of your analysis

*Below is a template you can use.*

------------------------------------------------------------------------

### Introduction

-   What is the data?

The data features various pieces of information gathered on three species of Penguins around the Palmer Station, Antarctica. Collected variables include geographical data, various morphological characteristics, and details on reproductive success.

-   *Load the data*

I start by loading the libraries we will be using. To protect the environment, I will be using renv(). This is a package that ensures the packages we use have a record of which version was being used at the time we write our code. This prevents subsequent updates to packages from affecting our code's functionality.

I considered loading packages in a separate file and importing them with source(); however, opt not to as, despite keeping the code marginally cleaner, readers are forced to open an additional file and reduces the level of self-containment from the .Rmd file. Users can then use renv::status() to ensure the packages are correctly loaded in a consistent state.

```{r Data Exploration, echo=TRUE}



# Make sure your code prints.

#i.e use echo


library("renv") 
library("knitr") 
library("rmarkdown") 
library("here") 
library("tidyverse") 
library("janitor")

renv::status()
```

On to the data itself. This was downloaded from Canvas and placed in a file, created and named "data". I could load the data from the "palmerpenguins" package. However, more often in reality we will be loading data from files rather than R packages. Hence, I push the file to my GitHub Repository. If someone downloads the repository, this should be perfectly functional. I then like to look at the data in full.

```{r echo=TRUE}
penguins_raw <- read_csv(here("data", "penguins_raw.csv"))

View(penguins_raw)
```

This uses the read_csv() function, contained in tidyverse and producing a "tibble". Tibbles are a "modern take on data frames" (R Core Team, 2024). The here() function avoids privacy concerns by sidestepping entering file directories and improves operating system cross-compatibility.

Next in the pipeline, we can further familiarize ourselves with the data by looking at the column names

```{r}
colnames(penguins_raw)
```

It is apparent from the mixture of styles (e.g. camel case and sentence case) and abundance of error causing characters (e.g. spaces, brackets, and slashes) that we should clean our dataset. Here, it is important to resist the urge to edit the raw data, as this ruins reproducibility. Instead we should make a new dataset.

```{r}
source(here("functions", "cleaning.r"))

penguins_clean <- penguins_raw %>%
  cleaning_columns() %>% #automatically snake case
  shorten_species() %>%
  remove_empty_columns_rows() %>% 
  remove_NA() %>% # by removing NA, the previous numbers become misaligned, and Tibble handles it automatically. 
  select(-x1) # remove column "x1"
  select(-sample_number)

View(penguins_clean)

colnames(penguins_clean)

```

The above code begins by sourcing a file named "cleaning.r" from within our directory. It uses Dr France's functions for cleaning the data, which itself uses generic cleaning functions from the "janitor" package. By using \`source()\` and a separate file, we streamline our work by ensuring any functions which may be used multiple times in the project only need to be edited in one place. The code also makes use of a "pipe", here styled as part of the "tidyverse" package. It is essentially equivalent to the instruction "and then".

-   *Create an Exploratory Figure (**not a boxplot**)*

I'm interested in whether there is any relationship between the categorical variable "clutch_completion" and "body_mass_g". I expect this to naturally vary between species and sex, so want to control for those factors. I will assume that time and geographical factors are independent.

"(21) Subset the Data

As part of data pipelines, we often want to subset the data for plotting or analysis. We may only want to look at two columns, the species and the body mass. We can do this by using the `select()` function."

```{r}
body_mass_clutch <- penguins_clean %>%
  select(species, body_mass_g, sex, clutch_completion) 

ggplot(body_mass_clutch, aes(x = clutch_completion, y = body_mass_g, fill = clutch_completion)) +
  geom_boxplot() +
  facet_wrap(~species) +
  theme_minimal() +
  scale_fill_brewer(palette = "Set3") + # change color palette
  labs(title = "Body Mass by Clutch Completion for Each Species",
       x = "Clutch Completion",
       y = "Body Mass (g)",
       fill = "Clutch Completion")
```

### Hypothesis

$\text{H}_0 :$ There is no significant difference in clutch completion according to body mass.

$\text{H}_{a1} :$ Penguins with greater body mass have significantly higher clutch completions.

$\text{H}_{a2} :$ Penguins with greater body mass have significantly lower clutch completions.

### Statistical Methods

It should be possible to run a binomial logistic regression with clutch_completion as the response variable.

```{r Statistics}
#convert completion into 1 = yes, 0 = no.
body_mass_clutch$clutch_completion_binary <- ifelse(body_mass_clutch$clutch_completion == "Yes", 1, 0) # new column to avoid over

View(body_mass_clutch)


logistic_regression_model <- glm(clutch_completion_binary ~ body_mass_g + sex + species, 
             family = binomial(link = "logit"), 
             data = body_mass_clutch)
summary(logistic_regression_model)



```

```{r}
library(car)
vif(logistic_regression_model)
```

This indicates moderate multicollinearity between factors, especially body_mass_g. However, it is not so extreme as to exclude any variables from the model. Instead we should be cautious to consider multicollinearities potential bias when interpreting the model.

```{r}
library(MASS)
stepwise_model <- stepAIC(logistic_regression_model, direction = "both")
summary(stepwise_model)
```

Similarly, when veryifying our results by performing selection to ensure there is no overfitting, We see that Species is the only significant factor in determining clutch completion that we included in our model.

### Results & Discussion

```{r Plotting Results}

# Make sure your code prints. 

```

### Conclusion

------------------------------------------------------------------------

## QUESTION 3: Open Science

### a) GitHub

*Upload your RProject you created for **Question 2** and any files and subfolders used to GitHub. Do not include any identifiers such as your name. Make sure your GitHub repo is public.*

*GitHub link:*

*You will be marked on your repo organisation and readability.*

### b) Share your repo with a partner, download, and try to run their data pipeline.

*Partner's GitHub link:*

*You **must** provide this so I can verify there is no plagiarism between you and your partner.*

### c) Reflect on your experience running their code. (300-500 words)

-   *What elements of your partner's code helped you to understand and run their data pipeline?*

-   *Did it run? Did you need to fix anything?*

-   *What suggestions would you make for improving their code to make it more understandable or reproducible, and why?*

-   *If you needed to alter your partner's figure using their code, do you think that would be easy or difficult, and why?*

### d) Reflect on your own code based on your experience with your partner's code and their review of yours. (300-500 words)

-   *What improvements did they suggest, and do you agree?*

-   *What did you learn about writing code for other people?*

### e) What are the main barriers for scientists to share their data and code, and what could be done to overcome them? (500-700 words)

-   Maitner et al. Code sharing increases citations, but remains uncommon. <https://doi.org/10.21203/rs.3.rs-3222221/v1>
-   Trisovic et al. A large-scale study on research code quality and execution. <https://rdcu.be/dZB7x>
-   A Rock-Star Researcher Spun a Web of Lies---and Nearly Got Away with It. <https://thewalrus.ca/a-rock-star-researcher-spun-a-web-of-lies-and-nearly-got-away-with-it/>
-   Gomes et al. Why don't we share data and code? Perceived barriers and benefits to public archiving practices <https://doi.org/10.1098/rspb.2022.1113>
